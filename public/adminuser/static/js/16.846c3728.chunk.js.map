{"version":3,"sources":["app/pages/Login/index.js"],"names":["Login","params","useParams","signIn","useAuth","setLoading","useContext","AppContext","notificationRef","useRef","useState","validationErrors","setValidationErrors","email","setEmail","password","setPassword","useEffect","a","api","get","token","user","data","console","log","ref","className","xs","sm","md","lg","type","placeholder","value","invalid","onChange","target","addonType","color","onClick","schema","Yup","shape","required","validate","abortEarly","post","res","current","notify","message","setTimeout","ve","inner","forEach","e","path","response"],"mappings":"0XAwLeA,UA/JD,WACZ,IAAMC,EAASC,cACPC,EAAWC,cAAXD,OACAE,EAAeC,qBAAWC,KAA1BF,WACFG,EAAkBC,mBAJN,EAK8BC,mBAAS,IALvC,mBAKXC,EALW,KAKOC,EALP,OAMQF,mBAAS,IANjB,mBAMXG,EANW,KAMJC,EANI,OAOcJ,mBAAS,IAPvB,mBAOXK,EAPW,KAODC,EAPC,KASlBC,qBAAU,WACR,sBAAC,8BAAAC,EAAA,sEAEGb,GAAW,GAFd,SAGgCc,IAAIC,IAAJ,kBAAmBnB,EAAOoB,QAH1D,gBAGiBC,EAHjB,EAGWC,KACRpB,EAAOF,EAAOoB,MAAOC,GACrBjB,GAAW,GALd,kDAOGA,GAAW,GACXmB,QAAQC,IAAR,MARH,yDAAD,KAWC,IAmEH,OAAIxB,EAAOoB,MACF,KAIP,eAAC,IAAD,WACE,cAAC,IAAD,CAAcK,IAAKlB,IACnB,cAAC,IAAD,CAAKmB,UAAU,yDAAf,SACE,cAAC,IAAD,CAAKC,GAAG,KAAKC,GAAG,KAAKC,GAAG,IAAIC,GAAG,IAA/B,SACE,cAAC,IAAD,CAAMJ,UAAU,MAAhB,SACE,cAAC,IAAD,UACE,eAAC,IAAD,WACE,uCACA,cAAC,IAAD,UACE,eAAC,IAAD,CACEA,UAAS,4BAAuBhB,EAAiBE,MAAQ,UAAY,IADvE,UAGE,cAAC,IAAD,CACEmB,KAAK,OACLC,YAAY,QACZC,MAAOrB,EACPsB,UAAWxB,EAAiBE,MAC5BuB,SAAU,gBAAaF,EAAb,EAAGG,OAAUH,MAAb,OAA2BpB,EAASoB,MAEhD,cAAC,IAAD,CAAiBI,UAAU,SAA3B,SACE,cAAC,IAAD,UACE,mBAAGX,UAAU,oBAGjB,cAAC,IAAD,UAAehB,EAAiBE,aAGpC,cAAC,IAAD,UACE,eAAC,IAAD,CAAYc,UAAS,4BAAuBhB,EAAiBI,SAAW,UAAY,IAApF,UACE,cAAC,IAAD,CACEiB,KAAK,WACLC,YAAY,QACZC,MAAOnB,EACPoB,UAAWxB,EAAiBI,SAC5BqB,SAAU,gBAAaF,EAAb,EAAGG,OAAUH,MAAb,OAA2BlB,EAAYkB,MAEnD,cAAC,IAAD,CAAiBI,UAAU,SAA3B,SACE,cAAC,IAAD,UACE,mBAAGX,UAAU,yBAGjB,cAAC,IAAD,UACGhB,EAAiBI,gBAIxB,cAAC,IAAD,UACE,cAAC,IAAD,CAAKa,GAAG,IAAR,SACE,cAAC,IAAD,CACEW,MAAM,UACNZ,UAAU,OACVa,QAzHC,WACnB,sBAAC,0CAAAtB,EAAA,sEAESK,EAAO,CACXV,QACAE,YAGI0B,EAASC,MAAaC,MAAM,CAChC9B,MAAO6B,MACJ7B,MAAM,sBACN+B,SAAS,oBACZ7B,SAAU2B,MAAaE,SAAS,uBAXrC,SAcSH,EAAOI,SAAStB,EAAM,CAC1BuB,YAAY,IAfjB,uBAmBqB3B,IAAI4B,KAAK,gBAAiBxB,GAnB/C,OAmBSyB,EAnBT,SAoB2BA,EAAIzB,KAApBF,EApBX,EAoBWA,MAAOC,EApBlB,EAoBkBA,KAEfd,EAAgByC,QAAQC,OAAO,CAC7BC,QAAS,gCAGXC,YAAW,WACTjD,EAAOkB,EAAOC,KACb,KA5BN,qDA8BGE,QAAQC,IAAR,MACAb,EAAoB,MAEhB,gBAAe8B,KAjCtB,wBAkCKlC,EAAgByC,QAAQC,OAAO,CAC7BC,QAAS,2BACTZ,MAAO,YAEHc,EAAK,GACX,KAAIC,MAAMC,SAAQ,SAACC,GACjBH,EAAGG,EAAEC,MAAQD,EAAEL,WAEjBvC,EAAoByC,GA1CzB,gCA8CO,MAAO,KAAIK,UAAY,KAAIA,SAASnC,MA9C3C,wBA+Ca4B,EAAY,KAAIO,SAASnC,KAAzB4B,QACR3C,EAAgByC,QAAQC,OAAO,CAC7BC,UACAZ,MAAO,WAlDd,2BAwDG/B,EAAgByC,QAAQC,OAAO,CAC7BC,QAAS,0BACTZ,MAAO,WA1DZ,yDAAD,IAqHgB","file":"static/js/16.846c3728.chunk.js","sourcesContent":["import React, { useEffect, useState, useRef, useContext } from 'react';\nimport { useParams } from 'react-router-dom';\nimport {\n  Button,\n  Card,\n  CardBody,\n  Container,\n  Col,\n  Row,\n  Form,\n  FormGroup,\n  Input,\n  InputGroup,\n  InputGroupText,\n  InputGroupAddon,\n  FormFeedback,\n} from 'reactstrap';\n\nimport * as Yup from 'yup';\n\nimport Notification from '../../components/Notification';\nimport { AppContext } from '../../contexts/app';\nimport { useAuth } from '../../hooks/auth';\nimport api from '../../services/api';\n\nconst Login = () => {\n  const params = useParams();\n  const { signIn } = useAuth();\n  const { setLoading } = useContext(AppContext);\n  const notificationRef = useRef();\n  const [validationErrors, setValidationErrors] = useState({});\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n\n  useEffect(() => {\n    (async () => {\n      try {\n        setLoading(true);\n        const { data: user } = await api.get(`/tokens/${params.token}`);\n        signIn(params.token, user);\n        setLoading(false);\n      } catch (error) {\n        setLoading(false);\n        console.log(error);\n      }\n    })();\n  }, []);\n\n  const handleSubmit = () => {\n    (async () => {\n      try {\n        const data = {\n          email,\n          password,\n        };\n\n        const schema = Yup.object().shape({\n          email: Yup.string()\n            .email('E-mail inválido')\n            .required('Informe um email'),\n          password: Yup.string().required('Informe uma senha'),\n        });\n\n        await schema.validate(data, {\n          abortEarly: false,\n        });\n\n        // validation passed\n        const res = await api.post('/authenticate', data);\n        const { token, user } = res.data;\n\n        notificationRef.current.notify({\n          message: 'Login realizado com sucesso',\n        });\n\n        setTimeout(() => {\n          signIn(token, user);\n        }, 2000);\n      } catch (err) {\n        console.log(err);\n        setValidationErrors({});\n        // Validation failed\n        if (err instanceof Yup.ValidationError) {\n          notificationRef.current.notify({\n            message: 'Falha na Validação',\n            color: 'warning',\n          });\n          const ve = {};\n          err.inner.forEach((e) => {\n            ve[e.path] = e.message;\n          });\n          setValidationErrors(ve);\n          return;\n        }\n\n        if (err && err.response && err.response.data) {\n          const { message } = err.response.data;\n          notificationRef.current.notify({\n            message,\n            color: 'danger',\n          });\n\n          return;\n        }\n\n        notificationRef.current.notify({\n          message: 'Falha ao realizar Login',\n          color: 'danger',\n        });\n      }\n    })();\n  };\n\n  if (params.token) {\n    return null;\n  }\n\n  return (\n    <Container>\n      <Notification ref={notificationRef} />\n      <Row className=\"justify-content-center align-items-center w-100 vh-100\">\n        <Col xs=\"12\" sm=\"10\" md=\"6\" lg=\"5\">\n          <Card className=\"p-4\">\n            <CardBody>\n              <Form>\n                <h1>Login</h1>\n                <FormGroup>\n                  <InputGroup\n                    className={`input-group-merge ${validationErrors.email ? 'invalid' : ''}`}\n                  >\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Email\"\n                      value={email}\n                      invalid={!!validationErrors.email}\n                      onChange={({ target: { value } }) => setEmail(value)}\n                    />\n                    <InputGroupAddon addonType=\"append\">\n                      <InputGroupText>\n                        <i className=\"fas fa-user\" />\n                      </InputGroupText>\n                    </InputGroupAddon>\n                    <FormFeedback>{validationErrors.email}</FormFeedback>\n                  </InputGroup>\n                </FormGroup>\n                <FormGroup>\n                  <InputGroup className={`input-group-merge ${validationErrors.password ? 'invalid' : ''}`}>\n                    <Input\n                      type=\"password\"\n                      placeholder=\"Senha\"\n                      value={password}\n                      invalid={!!validationErrors.password}\n                      onChange={({ target: { value } }) => setPassword(value)}\n                    />\n                    <InputGroupAddon addonType=\"append\">\n                      <InputGroupText>\n                        <i className=\"fas fa-eye-slash\" />\n                      </InputGroupText>\n                    </InputGroupAddon>\n                    <FormFeedback>\n                      {validationErrors.password}\n                    </FormFeedback>\n                  </InputGroup>\n                </FormGroup>\n                <Row>\n                  <Col xs=\"6\">\n                    <Button\n                      color=\"primary\"\n                      className=\"px-4\"\n                      onClick={handleSubmit}\n                    >\n                      Login\n                    </Button>\n                  </Col>\n                </Row>\n              </Form>\n            </CardBody>\n          </Card>\n        </Col>\n      </Row>\n    </Container>\n  );\n};\n\nexport default Login;\n"],"sourceRoot":""}